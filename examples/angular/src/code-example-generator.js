/**
 * code-example-generator.js
 *
 * This NodeJS file is designed to generate the code examples look up object.
 *
 */

const fs = require("fs");
const path = require("path");
const dirpath = "./app/examples";
const ignoreHeader = "// @ignore-example-code-gen";
const codeExampleRegex = / *<app-code-example.*<\/app-code-example>\n/;

function getDirectoryAsObject(dir) {
  let obj = {};
  fs.readdirSync(dir).forEach((file) => {
    let fullPath = path.join(dir, file);

    if (fs.lstatSync(fullPath).isDirectory()) {
      obj = { ...obj, ...getDirectoryAsObject(fullPath) };
    } else {
      const fileText = fs.readFileSync(fullPath).toString();
      if (!fileText.startsWith(ignoreHeader)) {
        const cleanText = fileText.replace(codeExampleRegex, "");
        obj[file] = cleanText;
      }
    }
  });
  return obj;
}

fs.writeFileSync(
  "./app/examples/code-examples.ts",
  `
${ignoreHeader}
// Generated by code-example-generator.js
export const examplesCode: {[key: string]:string}  = ${JSON.stringify(
    getDirectoryAsObject(dirpath)
  )}
`
);
